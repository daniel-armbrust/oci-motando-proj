{% extends "include/desktop_base.html" %}
{% block title %} Detalhes do Anúncio {% endblock %}
{% load static %}   
{% block head %}
   {{ block.super }}      
{% endblock %}
{% block body %}
   {% spaceless %} 
   {{ block.super }}
   {% load humanize %}
    <section>
        <div class="container">            
                <div class="row">
                    <div class="col-3 d-flex justify-content-start">
                        <a href="{% url 'home:main_page' %}">
                           <img src="{% static 'img/motando_logo-402x150.png' %}" class="img-fluid" alt="Motando">
                        </a>
                    </div> 
                    <div class="col-9 d-flex justify-content-end">
                        <img src="{% static 'img/banner-2.jpg' %}" class="img-fluid float-end" alt="Banner 2">
                    </div>                         
                </div>
                <div class="row pt-4">
                    <div class="col-12 d-flex p-2 ms-1">
                        <nav style="--bs-breadcrumb-divider: '>'; background-color: #F7F7F7; border: 0;" aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="{% url 'home:main_page' %}" class="text-decoration-none">Home</a></li>
                                <li class="breadcrumb-item"><a href="#" class="text-decoration-none"> Classificados </a></li>
                                <li class="breadcrumb-item"><a href="#" class="text-decoration-none"> {{ classifiedad.model.brand.brand }} </a></li>
                                <li class="breadcrumb-item"><a href="#" class="text-decoration-none"> {{ classifiedad.model.model }} </a></li>
                                <li class="breadcrumb-item active" aria-current="page">
                                    <a class="text-decoration-none"
                                       href="{% url 'classifiedad:detail' brand=classifiedad.model.brand.brand|slugify|lower model=classifiedad.model.model|slugify|lower model_year=classifiedad.model_year classifiedad_id=classifiedad.id %}">
                                        {{ classifiedad.model.brand.brand }} - {{ classifiedad.model.model }}
                                    </a>
                                </li>                                
                            </ol>
                        </nav>              
                    </div>
                </div>                    
        </div>
    </section> 
    <br>
    <section>
        <div class="container">
            <div class="row">
                <div class="col-8">                    
                    <div class="mb-4 pb-3 shadow rounded bg-white border p-3">
                        <h1 class="h4 my-text-purple">
                            <strong> 
                               {{ classifiedad.model.brand.brand }} - {{ classifiedad.model.model }} 
                            </strong>
                        </h1>
                        <p class="pt-2 ms-4">                        
                            <i class="far fa-calendar-alt"></i> {{ classifiedad.fabrication_year }}/{{ classifiedad.model_year }} &nbsp;&nbsp;
                            <i class="fas fa-fill-drip"></i> {{ classifiedad.color|title }} &nbsp;&nbsp;
                            <i class="fas fa-tachometer-alt"></i> {{ classifiedad.mileage|intcomma }} Km &nbsp;&nbsp;
                            {% if classifiedad.accept_exchange %}
                                <span class="text-success"><i class="far fa-times-circle"></i> Aceita troca</span> &nbsp;&nbsp;                            
                            {% else %}
                                <span class="text-danger"><i class="far fa-times-circle"></i> Não aceita troca</span> &nbsp;&nbsp;                            
                            {% endif %}
                        </p>             
                        <div id="id_carousel_classifiedad_images" class="carousel slide classifiedad-details-carousel" data-bs-ride="carousel">
                            <div class="carousel-inner rounded">
                                {% for classifiedad_image in classifiedad.images.all %}
                                    {% if forloop.first %}
                                        <div class="carousel-item active">
                                    {% else %}
                                        <div class="carousel-item">
                                    {% endif %}                                    
                                        <img src="{{ classifiedad_image.url }}" class="img-fluid rounded d-block w-100"
                                             alt="{{ classifiedad.model.brand.brand }} - {{ classifiedad.model.model }} | {{ forloop.counter }}">
                                    </div>
                                {% endfor %}                                
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#id_carousel_classifiedad_images" data-bs-slide="prev">
                              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#id_carousel_classifiedad_images" data-bs-slide="next">
                              <span class="carousel-control-next-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Next</span>
                            </button>
                        </div>                             
                        <div class="pt-1">
                            <br><br>
                        </div>
                    </div>                    
                </div>     
                <div class="col-4">         
                    <div class="bg-white shadow rounded-bottom">
                        <div class="row">
                            <div class="col">
                               <h2 class="h2 fw-bold rounded-top my-background-purple text-white p-3 text-center"> 
                                   R$ {{ classifiedad.price|intcomma }} 
                               </h2>
                               <p class="fw-bold text-center fs-5"> Entre em contato com o anunciante </p>
                            </div> 
                        </div>
                        <form class="p-2" autocomplete="off">
                            {% csrf_token %} 
                            <div class="row">
                                <div class="col">                                
                                    <div class="form-group text-left ml-2 mr-3">
                                        <label for="{{ form.fullname.auto_id }}" class="form-label">{{ form.fullname.label }}</label>                                       
                                         {{ form.fullname }}                                        
                                         <small class="form-text text-muted">Digite o seu nome completo</small>                                                                               
                                    </div>                        
                                </div>    
                            </div>
                            <div class="row pt-3">
                                <div class="col">                                
                                    <div class="form-group text-left ml-2 mr-3">
                                        <label for="{{ form.email.auto_id }}" class="form-label">{{ form.email.label }}</label>
                                        {{ form.email }}
                                        <small class="form-text text-muted">Digite o seu e-mail</small>
                                    </div>                        
                                </div>    
                            </div>         
                            <div class="row pt-3">
                                <div class="col">                                
                                    <div class="form-group text-left ml-2 mr-3">
                                        <label for="{{ form.telephone.auto_id }}" class="form-label">{{ form.telephone.label }}</label>
                                        {{ form.telephone }}
                                        <small class="form-text text-muted">Digite o seu Telefone</small>
                                    </div>                        
                                </div>    
                            </div>                        
                            <div class="row pt-4">
                                <div class="col"> 
                                    <div class="form-floating">
                                        {{ form.message }}                                       
                                        <label for="{{ form.message.auto_id }}">{{ form.message.label }}</label>
                                      </div>
                                </div>
                            </div>
                            <div class="row pt-2">
                                <div class="col"> 
                                    <img src="img/recaptcha.JPG" alt="" class="img-fluid">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col pt-2"> 
                                    <div class="d-grid gap-2">
                                        <button type="button" id="id_btn_sendmsg" class="btn btn-success btn-lg">Enviar</button>
                                    </div>
                                </div>
                            </div>
                            <div class="modal" tabindex="-1" id="id_modal">
                                <div class="modal-dialog modal-dialog-centered">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      <h5 class="modal-title" id="id_modal_title"></h5>
                                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                      <p id="id_modal_message"></p>
                                    </div>
                                    <div class="modal-footer">
                                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>                                      
                                    </div>
                                  </div>
                                </div>
                            </div>                              
                            <div class="row">
                                <div class="col pt-3 pb-2 d-flex justify-content-center">                                 
                                    <a href="#" class="text-decoration-none text-danger"> 
                                        <i class="fas fa-ban text-danger"></i> Denunciar esta oferta 
                                    </a>
                                </div>
                            </div>
                        </form> 
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-8">           
                    <div class="bg-white shadow rounded-bottom">
                        <div class="row">
                            <div class="col">
                                <h3 class="h5 fw-bold rounded-top my-background-purple text-white p-3">
                                     <i class="far fa-file-alt"></i> Descrição do Anuncio
                                </h3>
                                <p class="fw-bold"></p>
                            </div> 
                        </div>
                        <div class="row ml-2 ">
                            <div class="col">
                                <div class="mb-3 p-2" style="min-height: 120px">                                   
                                     {{ classifiedad.description|safe }}                                    
                                </div>
                            </div>   
                        </div>                       
                    </div>    
                    <br>
                    <div class="bg-white shadow rounded-bottom">
                        <div class="row">
                            <div class="col">
                                <h3 class="h5 fw-bold rounded-top my-background-purple text-white p-3">
                                     <i class="far fa-file-alt"></i> Ficha Técnica
                                </h3>
                                <p class="fw-bold"></p>
                            </div> 
                        </div>
                        <div class="row ml-2 p-2">
                            <div class="col">
                                <div class="mb-3">
                                    <label for="id_moto_marca" class="form-label">Marca</label>
                                    <input type="text" class="form-control my-btn-outline p-0 text-secondary" id="id_moto_marca" 
                                           style="background-color: white; box-shadow: none;" value="{{ classifiedad.model.brand.brand }}" readonly>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="id_moto_familia" class="form-label">Familia</label>
                                    <input type="text" class="form-control my-btn-outline p-0 text-secondary" id="id_moto_familia" 
                                           style="background-color: white; box-shadow: none;" value="{{ classifiedad.model.model }}" readonly>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="id_moto_modelo" class="form-label">Modelo</label>
                                    <input type="text" class="form-control my-btn-outline p-0 text-secondary" id="id_moto_modelo" 
                                           style="background-color: white; box-shadow: none;" value="{{ classifiedad.model.model }}" readonly>
                                </div>
                            </div>                           
                        </div>
                        <div class="row ml-2 p-2">
                            <div class="col">
                                <div class="mb-3">
                                    <label for="id_moto_estilo" class="form-label">Estilo</label>
                                    <input type="text" class="form-control my-btn-outline p-0 text-secondary" id="id_moto_estilo" 
                                           style="background-color: white; box-shadow: none;" 
                                              {% if classifiedad.model.model.type %} 
                                                  value="{{ classifiedad.model.model.type }}" 
                                              {% else %}
                                                  value="Não especificado"
                                              {% endif %}
                                           readonly>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="id_moto_ano_fabricacao" class="form-label">Ano de fabricação</label>
                                    <input type="text" class="form-control my-btn-outline p-0 text-secondary" id="id_moto_ano_fabricacao" 
                                           style="background-color: white; box-shadow: none;" value="{{ classifiedad.model_year }}" readonly>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="id_moto_quilometragem" class="form-label">Quilometragem</label>
                                    <input type="text" class="form-control my-btn-outline p-0 text-secondary" id="id_moto_quilometragem" 
                                           style="background-color: white; box-shadow: none;" value="{{ classifiedad.mileage|intcomma }} Km" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="row ml-2 p-2">
                            <div class="col">
                                <div class="mb-3">
                                    <label for="id_moto_cilindradas" class="form-label">Cilindradas</label>
                                    <input type="text" class="form-control my-btn-outline p-0 text-secondary" id="id_moto_cilindradas" 
                                           style="background-color: white; box-shadow: none;" value="" readonly>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="id_moto_potencia" class="form-label">Potência</label>
                                    <input type="text" class="form-control my-btn-outline p-0 text-secondary" id="id_moto_potencia" 
                                           style="background-color: white; box-shadow: none;" value="" readonly>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="id_moto_freios" class="form-label">Freios</label>
                                    <input type="text" class="form-control my-btn-outline p-0 text-secondary" id="id_moto_freios" 
                                           style="background-color: white; box-shadow: none;" 
                                              {% if classifiedad.brake_system %}
                                                  value="{{ classifiedad.brake_system|title }}"
                                              {% else %}
                                                  value="Não especificado"
                                              {% endif %}
                                           readonly>
                                </div>
                            </div>
                        </div>
                        <div class="row ml-2 p-2">
                            <div class="col">
                                <div class="mb-3">
                                    <label for="id_moto_motor" class="form-label">Motor</label>
                                    <input type="text" class="form-control my-btn-outline p-0 text-secondary" id="id_moto_motor" 
                                           style="background-color: white; box-shadow: none;" value="" readonly>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label for="id_moto_refrigeracao_motor" class="form-label">Refrigeração do motor</label>
                                    <input type="text" class="form-control my-btn-outline p-0 text-secondary" id="id_moto_refrigeracao_motor" 
                                           style="background-color: white; box-shadow: none;" 
                                              {% if classifiedad.refrigeration %}
                                                  value="{{ classifiedad.refrigeration|title }}"
                                              {% else %}
                                                  value="Não especificado"
                                              {% endif %}
                                            readonly>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-1">
                                    <label for="id_moto_tipo_partida" class="form-label">Partida</label>
                                    <input readonly type="text" class="form-control my-btn-outline p-0 text-secondary" id="id_moto_tipo_partida" 
                                           style="background-color: white; box-shadow: none;" 
                                              {% if classifiedad.ignition_system %}
                                                 value="{{ classifiedad.ignition_system|title }}">
                                              {% else %}
                                                  value="Não especificado">
                                              {% endif %}                                            
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="col-4 pt-1">   
                    <div class="bg-white shadow rounded">
                        <div class="row p-3">
                            <div class="col pt-2">                            
                                <img src="{% static 'img/pessoa.png' %}" 
                                     alt="Pessoa" class="img-fluid img-thumbnail float-start me-3" style="max-width: 25%;">                           
                                <h3 class="h5 fw-bold"> {{ classifiedad.user.fullname }} </h3>
                                <p class="small">
                                    {{ classifiedad.user.userprofile.city.city }} / {{ classifiedad.user.userprofile.state.state }} <br>
                                    Cadastrado desde: {{ classifiedad.user.created|date:"d/F/Y" }}                                     
                                </p>
                            </div> 
                        </div>
                    </div>
                    <br>
                    <div class="bg-white shadow rounded">
                        <div class="row p-3">
                            <div class="col pt-2 text-center">                            
                                <p class="h5 pb-2">Compartilhe este anúncio</p>                                
                                <a href="https://api.whatsapp.com/send?text={{ 'Olá. Veja este anúncio:  https://'|urlencode }}{{ request.META.HTTP_HOST }}{{ request.get_full_path }}" 
                                   class="text-decoration-none" data-action="share/whatsapp/share">
                                    <img src="{% static '/img/whatapp-icon.png' %}" alt="Whatsapp" class="img-fluid p-3">
                                </a>                                                                   
                                <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u={{ 'https://'|urlencode }}{{ request.META.HTTP_HOST }}{{ request.get_full_path }}&amp;src=sdkpreparse" 
                                   class="fb-xfbml-parse-ignore" class="text-decoration-none">
                                    <img src="{% static '/img/facebook-icon.png' %}" alt="Facebook" class="img-fluid p-3">
                                </a>                                
                                <a target="_blank" href="https://twitter.com/share?url={{ 'https://'|urlencode }}{{ request.META.HTTP_HOST }}{{ request.get_full_path }}" 
                                   class="text-decoration-none">
                                    <img src="{% static '/img/twiter-icon.png' %}" alt="Twitter" class="img-fluid p-3">
                                </a>
                                {% comment %}
                                    <a href="#" class="text-decoration-none">
                                        <img src="{% static '/img/linkedin-icon.png' %}" alt="Linkedin" class="img-fluid p-3"> 
                                    </a>
                                {% endcomment %}
                            </div> 
                        </div>
                    </div>
                </div>
            </div>
            </div>
    </section>
    <br>
    <br>
    {% endspaceless %} 
{% endblock %}
{% block footer %}
      {% include "include/desktop_footer.html" %}
{% endblock %}
{% block body_scripts %}
     <script type="text/javascript" src="{% static 'vendor/owlcarousel/owl.carousel.min.js' %}"></script> 
     <script type="text/javascript" src="{% static 'vendor/jquery.blockUI.min.js' %}"></script> 
     <script type="text/javascript" src="{% static 'js/classifiedad-chat.js' %}"></script> 
     <script type="text/javascript">        
         $(document).ready(function(){
                $('#id_btn_sendmsg').click(function() { 
                    const userFromFullname = $('#{{ form.fullname.auto_id }}').val();                      
                    const userFromEmail = $('#{{ form.email.auto_id }}').val();   
                    const userFromTelephone = $('#{{ form.telephone.auto_id }}').val();   
                    const userFromMessage = $('#{{ form.message.auto_id }}').val();                      
                    const classifiedadId = '{{ classifiedad.id }}';
                    const chatMsgUrl = 'http://127.0.0.1:8001/api/chats/messages';
                                        
                    CLASSIFIEDAD_MSG.init([
                        userFromFullname, 
                        userFromEmail, 
                        userFromTelephone, 
                        userFromMessage,                         
                        classifiedadId, 
                        chatMsgUrl
                    ]);

                    CLASSIFIEDAD_MSG.sendUserMessage();
                });        
         });
     </script> 
{% endblock %}